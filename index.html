 <!DOCTYPE html>
 <html lang="en">
 <head>
 <meta charset="UTF-8">
 <title>Gem Spectra Display</title>
 <style>

  html {
    max-width: 600px;
  }

   body {
     font-family: Open sans, sans-serif;
     max-width: 600px;
   }
 
   #gameContainer {
     position: relative;
     width: 550px;
     height: 100px;
     padding: 10px;
   
   }
 
   .gems-row {
     display: flex;
     align-items: center;
     gap: 2em;
     margin-left: 6em;
   }
 
   .gem {
     text-align: center;
   }
 
   .gem img {
     width: 80px;
     height: 80px;
     border-radius: 50%;
     object-fit: cover;
   }
 
   #magnifier {
     position: absolute;
     left: 0px;
     top: 30px;
     width: 80px;
     height: 80px;
     border: 3px solid black;
     border-radius: 50%;
     cursor: grab;
     background: #161616;
     background: radial-gradient(circle,rgba(27, 186, 217, 0.143) 30%, rgba(255, 255, 255, 1) 100%);
     backdrop-filter: blur(1px);
    }


 
   .spectra-display {
     margin-top: 10px;
     width: 550px;
     padding: 10px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
   }
 
   .spectra {
     padding-bottom: 2em;
     text-align: center;
     width: 80%;
   }
 
   .spectra img {
     width: 100%;
     height: auto;
     transition: opactiy 0.3s;
   }

   h2 {
    font-family: Open sans, sans serif;
    font-size: 1em;

   }

  p {
    margin: 0;
  }

  #gem-area{
    padding: 1em;
    background-color: #ffffff;
  }

  #spectra-area {
    padding: 1em;
    background-color: #ffffff;
    border-top: 2px solid #161616;
  }

 </style>
 </head>
 <body>
 <section id="gem-area">
 <h2>Gems</h2>
 <div id="gameContainer">
   <div class="gems-row">
     <div class="gem">
       <p>Our Gem</p>
       <img src="images/ruby2.png" alt="Our Gem" 
            data-spectrum="images/spectrum_placeholder.png">
     </div>
     <div class="gem">
      <p>Red Spinel</p>
      <img id="spinelGem" src="images/spinelCut.png" alt="Red Spinel" 
           data-spectrum="images/spectrum_redSpinel.png">
     </div>
     <div class="gem">
       <p>Ruby</p>
       <img id="rubyGem" src="images/rubyCut.png" alt="Ruby" 
            data-spectrum="images/spectrum_ruby.png">
     </div>
   
   </div>
   <div id="magnifier" tabindex="0"></div>
 </div>
 </section>

 <section id="spectra-area">
 <h2>Spectra Display</h2>
 <div class="spectra-display">
   <div class="spectra">
     <b>Our Gem Spectrum</b><br>
     <img src="images/spectrum_ruby.png" alt="Absorption spectrum of our gem">
   </div>
   <div class="spectra">
     <b>Comparison Gem</b><br>
     <img id="comparisonSpectrum" src="images/spectrum_placeholder.png" 
          alt="Absorption spectrum of selected gem">
   </div>
 </div>
</section>
 
 <script>
   const magnifier = document.getElementById('magnifier');
   const comparisonSpectrum = document.getElementById('comparisonSpectrum');
   const rubyGem = document.getElementById('rubyGem');
   const spinelGem = document.getElementById('spinelGem');
   const gems = [rubyGem, spinelGem];
 
   let isDragging = false;
   let offsetX = 0, offsetY = 0;
 
   // Mouse Drag
   magnifier.addEventListener('mousedown', function (e) {
     isDragging = true;
     const rect = magnifier.getBoundingClientRect();
     offsetX = e.clientX - rect.left;
     offsetY = e.clientY - rect.top;
     magnifier.style.cursor = "grabbing";
   });
 
   document.addEventListener('mousemove', function (e) {
     if (isDragging) {
       moveMagnifier(e.clientX, e.clientY);
       checkGemCollision();
     }
   });
 
   document.addEventListener('mouseup', function () {
     isDragging = false;
     magnifier.style.cursor = "grab";
   });
 
   // Keyboard Controls
   magnifier.addEventListener('keydown', function (e) {
     const step = 10;
     const rect = magnifier.getBoundingClientRect();
     let x = rect.left;
     let y = rect.top;
 
     if (e.key === 'ArrowUp') {
       y -= step;
     } else if (e.key === 'ArrowDown') {
       y += step;
     } else if (e.key === 'ArrowLeft') {
       x -= step;
     } else if (e.key === 'ArrowRight') {
       x += step;
     }
 
     moveMagnifier(x + offsetX, y + offsetY);
     checkGemCollision();
     e.preventDefault();
   });
 
   function moveMagnifier(clientX, clientY) {
     const containerRect = document.getElementById('gameContainer').getBoundingClientRect();
     magnifier.style.left = (clientX - containerRect.left - offsetX) + 'px';
     magnifier.style.top = (clientY - containerRect.top - offsetY) + 'px';
   }

   function changeSpectrumImage(newSrc) {
  if (comparisonSpectrum.src.endsWith(newSrc)) return; // Prevent unnecessary change

  comparisonSpectrum.style.opacity = 0; // Start fade-out

  setTimeout(() => {
    comparisonSpectrum.src = newSrc;
    comparisonSpectrum.onload = () => {
      comparisonSpectrum.style.opacity = 1; // Fade back in when loaded
    };
  }, 300); // Wait for fade-out before swapping
}

   function checkGemCollision() {
  const magRect = magnifier.getBoundingClientRect();
  const magCenterX = magRect.left + magRect.width / 2;
  const magCenterY = magRect.top + magRect.height / 2;
  let matched = false;

  const triggerPadding = 10; // shrink hitbox by 10px from each side

  gems.forEach(gem => {
    const gemRect = gem.getBoundingClientRect();
    if (
      magCenterX >= gemRect.left + triggerPadding &&
      magCenterX <= gemRect.right - triggerPadding &&
      magCenterY >= gemRect.top + triggerPadding &&
      magCenterY <= gemRect.bottom - triggerPadding
    ) {
      comparisonSpectrum.src = gem.dataset.spectrum;
      matched = true;
    }
  });

  if (!matched) {
    comparisonSpectrum.src = "images/spectrum_placeholder.png";
  }
}

   
 </script>
 
 </body>
 </html>
 